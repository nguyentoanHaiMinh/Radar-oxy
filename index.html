<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <title>TRUNG T√ÇM KI·ªÇM SO√ÅT RADAR</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/tone/14.8.49/Tone.js"></script>
    <style>
        /* PH·∫¶N CSS - Y·∫æU T·ªê ART (TH·∫®M M·ª∏) */
        body {
            background-color: #050505; /* ƒêen s√¢u th·∫≥m */
            color: #00ff41; /* Xanh l√° Neon */
            font-family: 'Courier New', Courier, monospace; /* Ph√¥ng ch·ªØ Hacker */
            display: flex;
            flex-direction: column;
            align-items: center;
            margin: 0;
            padding: 20px;
        }

        h1 {
            text-transform: uppercase;
            letter-spacing: 4px;
            text-shadow: 0 0 10px #00ff41, 0 0 20px #00ff41;
            margin-bottom: 30px;
        }

        /* Khung ƒëi·ªÅu khi·ªÉn ch√≠nh */
        .control-panel {
            border: 2px solid #00ff41;
            padding: 25px;
            border-radius: 10px;
            box-shadow: 0 0 20px rgba(0, 255, 65, 0.2), inset 0 0 20px rgba(0, 255, 65, 0.1);
            margin-bottom: 20px;
            width: 90%;
            max-width: 650px;
        }

        /* Canvas v√† V√πng Hi·ªÉn th·ªã */
        #radarDisplay {
            display: flex;
            gap: 20px;
            align-items: flex-start;
            justify-content: center;
            width: 100%;
            max-width: 1280px;
        }

        #radarCanvas {
            display: block;
            border: 1px solid #00ff41;
            box-shadow: 0 0 15px #00ff41, inset 0 0 15px #00ff41;
            border-radius: 5px;
            background-color: #0a0a0a;
            /* K√≠ch th∆∞·ªõc ƒë∆∞·ª£c set trong JS: 600x600 */
        }

        .data-panel {
            width: 350px;
            padding: 20px;
            border: 1px dashed #00ff41;
            border-radius: 8px;
        }

        .data-item {
            margin-bottom: 10px;
            padding: 5px 0;
            border-bottom: 1px dotted #1a4f1e;
        }

        .data-item strong {
            color: #ffffff;
            font-size: 1.1em;
        }

        input[type="number"] {
            background-color: #1a1a1a;
            border: 1px solid #00ff41;
            color: #00ff41;
            padding: 5px;
            width: 60px;
            margin-left: 10px;
            text-align: center;
        }

        /* Tr·∫°ng th√°i */
        #status {
            font-size: 1.5em;
            font-weight: bold;
            margin-top: 20px;
            padding: 10px;
            border-radius: 5px;
            text-shadow: 0 0 5px currentColor;
        }

        .danger {
            color: #ff0000;
            background-color: rgba(255, 0, 0, 0.1);
            border: 1px solid #ff0000;
            animation: pulse-danger 1s infinite alternate;
        }

        .safe {
            color: #00ff41;
            background-color: rgba(0, 255, 65, 0.1);
            border: 1px solid #00ff41;
        }

        @keyframes pulse-danger {
            from {
                box-shadow: 0 0 10px #ff0000;
            }
            to {
                box-shadow: 0 0 30px #ff0000;
            }
        }
    </style>
</head>
<body>
    <!-- Y√™u c·∫ßu 1: Hi·ªán t√™n Trung t√¢m ki·ªÉm so√°t Radar -->
    <h1>TRUNG T√ÇM KI·ªÇM SO√ÅT RADAR</h1>
    
    <div class="control-panel">
        <p><strong>C√†i ƒê·∫∑t V√πng Ph·ªß S√≥ng (ƒê∆∞·ªùng Tr√≤n):</strong></p>
        <div>
            T√¢m A(a, b):
            a = <input type="number" id="input_a" value="0" step="1" oninput="updateData()">
            b = <input type="number" id="input_b" value="0" step="1" oninput="updateData()">
            <br>
            B√°n k√≠nh R = <input type="number" id="input_R" value="5" min="1" max="10" step="1" oninput="updateData()">
        </div>
        
        <p style="margin-top: 15px;"><strong>V·ªã Tr√≠ M·ª•c Ti√™u M(x‚ÇÄ, y‚ÇÄ):</strong></p>
        <div>
            x‚ÇÄ = <input type="number" id="input_x0" value="7" step="1" oninput="updateData()">
            y‚ÇÄ = <input type="number" id="input_y0" value="3" step="1" oninput="updateData()">
        </div>
        
        <!-- Y√™u c·∫ßu 2: Hi·ªán c·∫£nh b√°o m·ª•c ti√™u trong v√πng ki·ªÉm so√°t -->
        <div id="status">CH·ªú D·ªÆ LI·ªÜU...</div>
    </div>
    
    <div id="radarDisplay">
        <canvas id="radarCanvas"></canvas>
        <div class="data-panel">
            <h2>H·ªÜ TH·ªêNG PH√ÇN T√çCH</h2>
            <div class="data-item">T√¢m A: <strong id="output_A">...</strong></div>
            <div class="data-item">B√°n k√≠nh R: <strong id="output_R">...</strong></div>
            <div class="data-item">M·ª•c ti√™u M: <strong id="output_M">...</strong></div>
            <div class="data-item">Kho·∫£ng c√°ch IM: <strong id="output_IM">...</strong></div>
            <div class="data-item">Tr·∫°ng th√°i so s√°nh (IM vs R): <strong id="output_compare">...</strong></div>
            
            <p style="margin-top: 20px; font-size: 0.9em;">
                <span style="color: #ff0000;">üî¥ Nguy hi·ªÉm (IM &lt; R): M·ª•c ti√™u ƒë√£ v√†o v√πng.</span><br>
                <span style="color: #ffff00;">üü° An to√†n (IM &gt; R): M·ª•c ti√™u ngo√†i v√πng.</span>
            </p>
        </div>
    </div>

    <script>
        // --- C·∫§U H√åNH V√Ä BI·∫æN TO√ÄN C·ª§C ---
        const canvas = document.getElementById('radarCanvas');
        const ctx = canvas.getContext('2d');
        const CANVAS_SIZE = 600; // K√≠ch th∆∞·ªõc c·ªë ƒë·ªãnh cho Canvas (600x600)
        canvas.width = CANVAS_SIZE;
        canvas.height = CANVAS_SIZE;

        // KHAI B√ÅO C√ÅC BI·∫æN CH√çNH (S·ª≠ d·ª•ng 'var' ƒë·ªÉ tr√°nh l·ªói khai b√°o l·∫°i)
        var a = 0, b = 0, R = 5; // Th√¥ng s·ªë ƒê∆∞·ªùng Tr√≤n
        var x0 = 7, y0 = 3; // Th√¥ng s·ªë ƒêi·ªÉm M
        var IM = 0; // Kho·∫£ng c√°ch
        
        // C·∫•u h√¨nh √¢m thanh (Tone.js)
        const synth = new Tone.Oscillator(440, "sine").toDestination();
        var isPlaying = false; // Tr·∫°ng th√°i √¢m thanh

        // C√°c bi·∫øn h·ªó tr·ª£ v·∫Ω
        var drawA_x = 0;
        var drawA_y = 0;
        var drawR = 0;
        
        // T·ªëc ƒë·ªô v√† g√≥c qu√©t (V·ªát s√°ng)
        var sweepAngle = 0;
        const SWEEP_SPEED = 0.03; // T·ªëc ƒë·ªô qu√©t (Radian/frame)

        // T·ªâ l·ªá scale (1 ƒë∆°n v·ªã tr√™n m·∫∑t ph·∫≥ng to√°n h·ªçc = 30px tr√™n canvas)
        const scale = 30;

        // --- H√ÄM X·ª¨ L√ù √ÇM THANH ---

        // H√†m ph√°t c·∫£nh b√°o (beep)
        function startWarningBeep() {
            if (!isPlaying) {
                // T·∫ßn s·ªë cao v√† l·∫∑p l·∫°i
                synth.frequency.value = 880; 
                synth.start();
                isPlaying = true;
                // Th√™m m·ªôt hi·ªáu ·ª©ng ng·∫Øt/ng√¢n nh·∫π ƒë·ªÉ t·∫°o c·∫£m gi√°c "beep" li√™n t·ª•c
                if (!window.beepInterval) {
                     window.beepInterval = setInterval(() => {
                        if (isPlaying) {
                           synth.volume.value = -10; // Gi·∫£m √¢m l∆∞·ª£ng 
                           setTimeout(() => {
                               synth.volume.value = 0; // TƒÉng l·∫°i
                           }, 100);
                        }
                    }, 500); // L·∫∑p l·∫°i m·ªói 0.5s
                }
            }
        }

        // H√†m d·ª´ng c·∫£nh b√°o
        function stopWarningBeep() {
            if (isPlaying) {
                synth.stop();
                isPlaying = false;
                clearInterval(window.beepInterval);
                window.beepInterval = null;
            }
        }

        // --- H√ÄM T√çNH TO√ÅN (LOGIC TO√ÅN H·ªåC) ---

        function calculateDistance(a, b, x0, y0) {
            // IM = sqrt((x0 - a)^2 + (y0 - b)^2)
            return Math.sqrt(Math.pow(x0 - a, 2) + Math.pow(y0 - b, 2));
        }

        // --- H√ÄM V·∫º (VISUALIZATION) ---

        // H√†m v·∫Ω to√†n b·ªô c·∫£nh (ch·∫°y trong v√≤ng l·∫∑p animation)
        function drawScene() {
            const center_x = canvas.width / 2;
            const center_y = canvas.height / 2;

            // 1. X√≥a canvas
            ctx.fillStyle = '#050505'; // M√†u n·ªÅn ƒëen
            ctx.fillRect(0, 0, canvas.width, canvas.height);

            // 2. T√≠nh to√°n l·∫°i t·ªça ƒë·ªô v·∫Ω (Canvas Coordinates)
            // L∆∞u √Ω: T·ªça ƒë·ªô y tr√™n canvas ng∆∞·ª£c v·ªõi t·ªça ƒë·ªô y to√°n h·ªçc
            drawA_x = center_x + a * scale;
            drawA_y = center_y - b * scale;
            drawR = R * scale;
            
            var drawM_x = center_x + x0 * scale;
            var drawM_y = center_y - y0 * scale;

            // 3. V·∫Ω L∆∞·ªõi t·ªça ƒë·ªô (Grid) - KH·∫ÆC PH·ª§C L·ªÜCH TR·ª§C
            const gridColor = '#1a3a1f'; // Xanh l√° ƒë·∫≠m, m·ªù
            ctx.strokeStyle = gridColor;
            ctx.lineWidth = 0.5;

            // V·∫Ω l∆∞·ªõi v√† nh√£n (t·ª´ -10 ƒë·∫øn 10)
            ctx.fillStyle = '#00ff41';
            ctx.font = '12px Courier New';
            
            for (let i = -10; i <= 10; i++) {
                // ƒê∆∞·ªùng l∆∞·ªõi ngang (Y=i)
                const y_pos = center_y - i * scale;
                ctx.beginPath();
                ctx.moveTo(0, y_pos);
                ctx.lineTo(canvas.width, y_pos);
                ctx.stroke();
                
                // ƒê∆∞·ªùng l∆∞·ªõi d·ªçc (X=i)
                const x_pos = center_x + i * scale;
                ctx.beginPath();
                ctx.moveTo(x_pos, 0);
                ctx.lineTo(x_pos, canvas.height);
                ctx.stroke();

                // Nh√£n s·ªë (tr·ª´ 0)
                if (i !== 0) {
                    // Nh√£n X
                    ctx.fillText(i, x_pos - 5, center_y + 15);
                    // Nh√£n Y
                    ctx.fillText(i, center_x + 5, y_pos + 5);
                }
            }

            // 4. V·∫Ω TR·ª§C T·ªåA ƒê·ªò CH√çNH (X=0 v√† Y=0)
            ctx.strokeStyle = '#00ff41'; // Xanh l√° Neon
            ctx.lineWidth = 1;
            
            // Tr·ª•c X (Y=0)
            ctx.beginPath();
            ctx.moveTo(0, center_y);
            ctx.lineTo(canvas.width, center_y);
            ctx.stroke();
            // Tr·ª•c Y (X=0)
            ctx.beginPath();
            ctx.moveTo(center_x, 0);
            ctx.lineTo(center_x, canvas.height);
            ctx.stroke();

            // V·∫Ω g·ªëc O(0,0) v√† nh√£n tr·ª•c
            ctx.fillStyle = '#00ff41';
            ctx.beginPath();
            ctx.arc(center_x, center_y, 4, 0, 2 * Math.PI);
            ctx.fill();
            ctx.fillText('X', canvas.width - 20, center_y - 10);
            ctx.fillText('Y', center_x + 10, 20);
            ctx.fillText('O', center_x + 10, center_y + 15);

            // 5. V·∫Ω ƒê∆∞·ªùng tr√≤n (V√πng ph·ªß s√≥ng Radar)
            
            // Y√™u c·∫ßu 3: T√¥ m√†u v√πng ph·ªß s√≥ng r√µ r√†ng h∆°n
            // ƒê·∫∑t ƒë·ªô trong su·ªët cao h∆°n (0.15) ƒë·ªÉ v√πng ph·ªß s√≥ng r√µ r√†ng nh∆∞ng v·∫´n kh√¥ng che khu·∫•t l∆∞·ªõi.
            ctx.fillStyle = 'rgba(0, 255, 65, 0.15)'; 
            ctx.beginPath();
            ctx.arc(drawA_x, drawA_y, drawR, 0, 2 * Math.PI);
            ctx.fill(); // T√¥ m√†u b√™n trong (V√πng ki·ªÉm so√°t)

            ctx.strokeStyle = '#00ff41'; // M√†u vi·ªÅn
            ctx.lineWidth = 3;
            ctx.beginPath();
            ctx.arc(drawA_x, drawA_y, drawR, 0, 2 * Math.PI);
            ctx.stroke(); // V·∫Ω vi·ªÅn
            
            // V·∫Ω T√¢m A
            ctx.fillStyle = '#ffffff';
            ctx.beginPath();
            ctx.arc(drawA_x, drawA_y, 6, 0, 2 * Math.PI);
            ctx.fill();
            ctx.fillStyle = '#050505';
            ctx.beginPath();
            ctx.arc(drawA_x, drawA_y, 3, 0, 2 * Math.PI);
            ctx.fill();

            // Nh√£n T√¢m A
            ctx.fillStyle = '#ffffff';
            ctx.fillText(`A(${a}, ${b})`, drawA_x + 10, drawA_y - 10);


            // --- V·∫º V·ªÜT S√ÅNG QU√âT RADAR ---
            const sweepColor = 'rgba(0, 255, 65, 0.4)'; // M√†u xanh l√° trong su·ªët
            const sweepEndAngle = sweepAngle;
            const sweepStartAngle = sweepEndAngle - Math.PI / 6; // G√≥c qu√©t 30 ƒë·ªô (Math.PI / 6)

            ctx.save();
            ctx.globalAlpha = 0.8; 
            ctx.fillStyle = sweepColor;

            // V√≤ng l·∫∑p n√†y v·∫Ω h√¨nh qu·∫°t qu√©t t·ª´ T√¢m A
            ctx.beginPath();
            ctx.moveTo(drawA_x, drawA_y); 
            // G√≥c canvas ƒëo theo chi·ªÅu kim ƒë·ªìng h·ªì, n√™n c·∫ßn ƒë·∫£o ng∆∞·ª£c d·∫•u g√≥c.
            // B√°n k√≠nh l·ªõn h∆°n R m·ªôt ch√∫t ƒë·ªÉ qu√©t ra ngo√†i v√≤ng tr√≤n
            const sweepRadius = drawR + 10; 
            ctx.arc(drawA_x, drawA_y, sweepRadius, -sweepStartAngle, -sweepEndAngle, true); 
            ctx.lineTo(drawA_x, drawA_y); 

            ctx.closePath();
            ctx.fill();
            ctx.restore();
            // --- K·∫æT TH√öC V·∫º V·ªÜT S√ÅNG ---


            // 6. X·ª≠ l√Ω V·ªã tr√≠ M·ª•c ti√™u M v√† Hi·ªÉn th·ªã Tr·∫°ng th√°i
            const statusEl = document.getElementById('status');
            var colorPoint = "";
            
            // X·ª≠ l√Ω logic so s√°nh
            if (IM < R) {
                // TR∆Ø·ªúNG H·ª¢P 1: N·∫∞M TRONG (NGUY HI·ªÇM)
                // C·∫£nh b√°o m·ª•c ti√™u trong v√πng ki·ªÉm so√°t
                statusEl.innerHTML = "üî¥ C·∫¢NH B√ÅO: M·ª§C TI√äU ƒê√É V√ÄO V√ôNG KI·ªÇM SO√ÅT"; 
                statusEl.className = "danger";
                colorPoint = "#ff0000"; // ƒê·ªè
                
                // üîä PH√ÅT √ÇM THANH C·∫¢NH B√ÅO üîä
                startWarningBeep();
                
                // Minh h·ªça kho·∫£ng c√°ch (ƒê∆∞·ªùng ƒë·ª©t n√©t)
                ctx.beginPath();
                ctx.strokeStyle = "red";
                ctx.setLineDash([5, 5]); 
                ctx.moveTo(drawA_x, drawA_y);
                ctx.lineTo(drawM_x, drawM_y);
                ctx.stroke();
                ctx.setLineDash([]); 
            } else {
                // TR∆Ø·ªúNG H·ª¢P 2: N·∫∞M NGO√ÄI (AN TO√ÄN)
                statusEl.innerHTML = "‚úÖ AN TO√ÄN: M·ª§C TI√äU NGO√ÄI V√ôNG KI·ªÇM SO√ÅT";
                statusEl.className = "safe"; 
                colorPoint = "#ffff00"; // V√†ng
                
                // üîá D·ª™NG √ÇM THANH N·∫æU ƒêANG CH·∫†Y üîá
                stopWarningBeep();
            }

            // 7. V·∫Ω ƒêi·ªÉm M
            ctx.fillStyle = colorPoint;
            ctx.beginPath();
            ctx.arc(drawM_x, drawM_y, 5, 0, 2 * Math.PI);
            ctx.fill();
            
            // Hi·ªáu ·ª©ng "ping" s√≥ng t·ªèa ra t·ª´ ƒëi·ªÉm M
            ctx.beginPath();
            ctx.strokeStyle = colorPoint;
            ctx.lineWidth = 1;
            ctx.arc(drawM_x, drawM_y, 10, 0, 2 * Math.PI);
            ctx.stroke();

            ctx.fillStyle = "white";
            ctx.fillText(`M(${x0}, ${y0})`, drawM_x + 10, drawM_y - 10);
        }

        // --- V√íNG L·∫∂P ANIMATION CH√çNH ---

        function animateRadar() {
            // 1. V·∫Ω to√†n b·ªô c·∫£nh (bao g·ªìm ƒëi·ªÉm M, radar, grid, v.v.)
            drawScene();

            // 2. C·∫≠p nh·∫≠t g√≥c qu√©t cho khung h√¨nh ti·∫øp theo
            sweepAngle += SWEEP_SPEED;
            if (sweepAngle > 2 * Math.PI) {
                sweepAngle -= 2 * Math.PI;
            }

            // 3. Y√™u c·∫ßu v·∫Ω khung h√¨nh ti·∫øp theo
            requestAnimationFrame(animateRadar);
        }

        // --- H√ÄM X·ª¨ L√ù S·ª∞ KI·ªÜN (INPUT) ---
        
        function updateData() {
            // ƒê·ªçc d·ªØ li·ªáu t·ª´ input v√† c·∫≠p nh·∫≠t bi·∫øn to√†n c·ª•c
            a = parseFloat(document.getElementById('input_a').value) || 0;
            b = parseFloat(document.getElementById('input_b').value) || 0;
            R = parseFloat(document.getElementById('input_R').value) || 5;
            x0 = parseFloat(document.getElementById('input_x0').value) || 0;
            y0 = parseFloat(document.getElementById('input_y0').value) || 0;

            // Ki·ªÉm tra r√†ng bu·ªôc R
            if (R <= 0) {
                R = 1;
                document.getElementById('input_R').value = 1;
            } else if (R > 10) {
                 R = 10;
                document.getElementById('input_R').value = 10;
            }

            // T√≠nh to√°n kho·∫£ng c√°ch
            IM = calculateDistance(a, b, x0, y0);

            // C·∫≠p nh·∫≠t c√°c output trong Data Panel
            document.getElementById('output_A').textContent = `(${a}, ${b})`;
            document.getElementById('output_R').textContent = R.toFixed(2);
            document.getElementById('output_M').textContent = `(${x0}, ${y0})`;
            document.getElementById('output_IM').textContent = IM.toFixed(2);
            
            var compareText = '';
            if (IM < R) {
                compareText = 'IM < R (M·ª•c ti√™u ƒë√£ v√†o v√πng)';
            } else if (IM > R) {
                compareText = 'IM > R (M·ª•c ti√™u ngo√†i v√πng)';
            } else {
                compareText = 'IM = R (M·ª•c ti√™u n·∫±m tr√™n bi√™n)';
            }
            document.getElementById('output_compare').textContent = compareText;

            // V√≤ng l·∫∑p animation s·∫Ω t·ª± ƒë·ªông g·ªçi drawScene()
        }

        // --- KH·ªûI T·∫†O ---

        // Kh·ªüi t·∫°o tr·∫°ng th√°i ban ƒë·∫ßu
        updateData(); 
        
        // B·∫Øt ƒë·∫ßu v√≤ng l·∫∑p animation
        animateRadar();

    </script>
</body>
</html>